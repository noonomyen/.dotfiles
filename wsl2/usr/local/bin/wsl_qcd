#!/usr/bin/bash

PWD_TMP="/tmp/wsl_qcd_$USER.tmp"

if [[ $# -eq 0 ]]; then
    echo $PWD > $PWD_TMP
    echo $PWD
elif [[ $# -eq 1 && $1 == "clear" ]]; then
    rm -rf $PWD_TMP
elif [[ $# -eq 2 && $1 == "login" ]]; then
    DEFALLT_SHELL=$(awk -F: -v USER=$2 '$1 == USER {print $7}' /etc/passwd)
    if [ -f $PWD_TMP ]; then
        TARGET=$(cat $PWD_TMP)
        cd $TARGET
        echo $TARGET
        exec $DEFALLT_SHELL
    else
        echo "directory not found"
        HOME_DIR=$(awk -F: -v USER=$2 '$1 == USER {print $6}' /etc/passwd)
        cd $HOME_DIR
        exec $DEFALLT_SHELL
    fi
else
    echo "Quick directory change for wsl login from terminal"
    echo "wsl_qcd                  -- for set target directory"
    echo "wsl_qcd clear            -- clear current target directory"
    echo "wsl_qcd login [username] -- change directory to target and login"
fi
